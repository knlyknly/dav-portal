var nx={VERSION:"0.9.0",global:function(){return this}.call(null),OPTIMIZED:!1,TEXTUAL:function(){try{return"function A(){}"===eval("(function A(){})").toString()}catch(e){return!1}}()},global=nx.global;nx.idle=function(){},nx.identity=function(a){return a},nx.bool=function(a){return!!a},nx.uuid=function(){var a,b=function(b){var c=12;if(b&&a){var c,d=a.length-1;for(c=0;12>c&&(a[d-c]++,!(a[d-c]<16));c++)a[d-c]=0}return 12>c?(c=0,"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){return a[c++].toString(16)}).toUpperCase()):(a=[],"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){var c=16*Math.random()|0,d="x"==b?c:3&c|8;return a.push(d),d.toString(16)}).toUpperCase())};return b.serial=function(){return b(!0)},b}(),nx.clone=function(){var a=function(){var a,b,c,d,e;return a=function(a,b){for(var c=0;c<a.length;c++)if(a[c].key===b)return a[c].value;return null},b=function(a,b,c){var d;for(d=0;d<a.length;d++)if(a[d].key===b)return void(a[d].value=c);a[d]={key:b,value:c}},c=function(a){return 0===a.length?null:a[a.length-1]},d=function(a){var b=[];if("[object Array]"==Object.prototype.toString.call(a))for(var c=0;c<a.length;c++)b.push(c);else for(var d in a)b.push(d);return b},e=function(e){if(window===e||document===e)return null;if(["null","undefined","number","string","boolean","function"].indexOf(typeof e)>=0)return e;if(!nx.is(e,"Array")&&!nx.is(e,"PlainObject"))return e;var f,g,h,i=[],j=[],k=e,l=nx.is(e,"Array")?[]:{};for(b(i,k,l),j.push({origin:k,dest:l,keys:d(k),idx:0});;){if(f=c(j),!f)break;if(k=f.origin,l=f.dest,f.keys.length<=f.idx)j.pop();else{if(g=f.keys[f.idx++],nx.is(k[g],"Array"))l[g]=[];else{if(!nx.is(k[g],"PlainObject")){l[g]=k[g];continue}l[g]={}}h=a(i,k[g]),h?l[g]=h:(b(i,k[g],l[g]),j.push({origin:k[g],dest:l[g],keys:d(k[g]),idx:0}))}}return l}}();return function(b,c){if(b){if(b.__clone__)return b.__clone__(c);if(c)return a(b);if(nx.is(b,"Array"))return b.slice(0);var d={};for(var e in b)b.hasOwnProperty(e)&&(d[e]=b[e]);return d}return b}}(),nx.extend=function(a){for(var b=1,c=arguments.length;c>b;b++){var d=arguments[b];for(var e in d)d.hasOwnProperty(e)&&(a[e]=d[e])}return a},function(a){var b=Object.prototype.hasOwnProperty,c=Object.prototype.toString;a.is=function(d,e){if(d&&d.__is__)return d.__is__(e);switch(e){case void 0:case"Undefined":return void 0===d;case null:case"Null":return null===d;case Object:case"Object":return d&&"object"==typeof d;case String:case"String":return"string"==typeof d;case Boolean:case"Boolean":return"boolean"==typeof d;case"NaN":return isNaN(d);case Number:case"Number":return"number"==typeof d;case"Function":return typeof d===e.toLowerCase();case Array:case"Array":return d&&d.constructor===Array;case"Arguments":return"[object Arguments]"===c.call(d);case"PlainObject":var f;if(!d||"[object Object]"!==c.call(d)||d.nodeType||d===window)return!1;try{if(d.constructor&&!b.call(d,"constructor")&&!b.call(d.constructor.prototype,"isPrototypeOf"))return!1}catch(g){return!1}for(f in d);return void 0===f||b.call(d,f);default:if("number"==typeof e&&"number"==typeof d&&isNaN(e)&&isNaN(d))return!0;if("string"==typeof e&&(e=a.path(e)),d&&e)if("function"==typeof e){if(d instanceof e)return!0}else if(e.prototype)return d instanceof e}return!1}}(nx),nx.each=function(a,b,c){var d=!1;if(a&&b)if(a.__class__&&a.__each__)d=!1===a.__each__(b,c);else if(nx.is(a,"Array")||"[object Arguments]"===Object.prototype.toString.call(a)||nx.global.NodeList&&a instanceof NodeList||nx.global.HTMLCollection&&a instanceof HTMLCollection){for(var e=0,f=a.length;f>e;e++)if(b.call(c,a[e],e)===!1){d=!0;break}}else for(var g in a)if(a.hasOwnProperty(g)&&b.call(c,a[g],g)===!1){d=!0;break}return!d},nx.path=function(a,b,c){var d=a;if(b){var e,f,g,h=0;if("string"==typeof b)e=b.split(".");else{if(!nx.is(b,"Array"))return a;e=b}if(g=e.length,arguments.length<=2)for(;d&&g>h;h++)f=e[h],d=d.__get__?d.__get__(f):d[f];else{for(g-=1;d&&g>h;h++)f=e[h],d=d.__get__?d.__get__(f):d[f]=d[f]||{};f=e[h],d&&(d.__set__?d.__set__(f,c):d[f]=c,d=c)}}return d},Function.prototype.bind||(Function.prototype.bind=function(a){var b=this;return function(){return b.apply(a,arguments)}}),function(a){var b=(a.global,Array.prototype.slice);a.func={apply:function(c,d){var e=arguments.length,f=arguments[e-1];return a.is(f,"Array")||(f=f&&f.length>=0?b.call(f):[]),e>3&&(f=b.call(arguments,2,e-1).concat(f)),c.apply(d,f)}}}(nx),nx.array={query:function(){var a,b={publics:{select:function(a,b){var c=[];if($.isArray(a)&&$.isFunction(b)){var d,e;for(d=0;d<a.length;d++)e=a[d],b(e)&&c.push(e)}return c},group:function(a,b){var c;if($.isFunction(b)){c={};var d,e,f;for(d=0;d<a.length;d++)e=b(a[d]),e&&"string"==typeof e&&(f=c[e]=c[e]||[],f.push(a[d]))}else c=a;return c},aggregate:function(a,b){var c,d=null;if($.isFunction(b))if($.isArray(a))d=b(a);else{d=[];for(c in a)d.push(b(a[c],c))}return d}},privates:{aggregate:function(a,c){var d,e=null,f=null;return $.isArray(c)?("function"==typeof c[c.length-1]&&(f=c.pop()),e=c.length>1?c:c[0]):(e=c.map,f=c.aggregate),"string"==typeof e&&(e=e.replace(/\s/g,"").split(",")),$.isArray(e)&&e[0]&&"string"==typeof e[0]&&(e=function(a){return function(b){var c,d={};for(c=0;c<a.length;c++)d[a[c]]=b[a[c]];return JSON.stringify(d)}}(e)),d=b.publics.aggregate(b.publics.group(a,e),f)},mapping:function(a,b){var c,d;if("string"==typeof b&&(b=function(a){return function(b){return nx.path(b,a)}}(b)),b===!0)d=EXPORT.clone(a);else if($.isFunction(b))if($.isArray(a))for(d=[],c=0;c<a.length;c++)d.push(b(a[c],c));else d=b(a,0);else d=$.isArray(a)?a.slice():a;return d},orderby:function(a,b){return"string"==typeof b&&(b=b.replace(/^\s*(.*)$/,"$1").replace(/\s*$/,"").replace(/\s*,\s*/g,",").split(",")),$.isArray(b)&&b[0]&&"string"==typeof b[0]&&(b=function(a){return function(b,c){var d,e,f;if(!b&&!c)return 0;for(d=0;d<a.length;d++){if(e=a[d],f=/\sdesc$/.test(e),e=e.replace(/(\s+desc|\s+asc)$/,""),b[e]>c[e])return f?-1:1;if(c[e]>b[e])return f?1:-1}return 0}}(b)),b&&"function"==typeof b&&a.sort(b),a}},query:function(a,c){return 1==arguments.length&&(c=a,a=c.array),a?(c.select&&(a=b.publics.select(a,c.select)),c.aggregate&&(a=b.privates.aggregate(a,c.aggregate)),c.mapping&&(a=b.privates.mapping(a,c.mapping)),c.orderby&&(a=b.privates.orderby(a,c.orderby)),a):a}};for(a in b.publics)b.query[a]=b.publics[a];return b.query}(),count:function(a,b){var c,d=a.length,e=0;for(c=0;d>c;c++)a[c]===b&&e++;return e},mapping:function(a,b,c){var d,e=[];for(d=0;d<a.length;d++)e[d]=b.call(c,a[d]);return e},cross:function(a,b,c){var d,e;d=function(a,b){var c,d,e=a.length,f=b.length;for(c=0,d=0;e>c;c++)for(d=0;f>d;d++)if(a[c]===b[d])return{i0:c,i1:d,value:a[c]};return null},e=function(a,b){var f=d(a,b),g=d(b,a),h=[[]];switch(f&&(h=EXPORT.mapcar(function(a){a.unshift(f.value)},e(a.slice(f.i0+1),b.slice(f.i1+1))),f.i0!==g.i1&&(h=h.concat(EXPORT.mapcar(function(a){a.unshift(g.value)},e(b.slice(g.i0+1),a.slice(g.i1+1)))))),c){case"max":h=[nx.array.query({array:h,orderby:"length desc"})[0]];break;case"min":h=[nx.array.query({array:h,orderby:"length"})[0]]}return h};var f=e(a,b);return"max"==c||"min"==c?f[0]:f},diff:function(a,b){var c,d,e,f,g,h,i,j=[];for(c=nx.array.cross(al,ar,"max"),d=e=0,g=h=i=ar.length,d=0,e=0,f=0,g=al.length,h=c.length,i=ar.length;g>d||h>e||i>f;d++,e++,f++){for(;g>d&&al[d]!==c[e];)j.push({action:"remove",position:f}),d++;for(;i>f&&c[e]!==ar[f];)j.push({action:"add",position:f,object:ar[f]}),f++}return j}},nx.date=function(){var a=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],b=["January","February","March","April","May","June","July","August","September","October","November","December"],c=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sept","Oct","Nov","Dec"],d=function(a){return("00"+a).slice(-2)},e={yyyy:function(a){return a.getFullYear()},yy:function(a){return a.getFullYear().toString().slice(-2)},MMMM:function(a){return b[a.getMonth()]},MMM:function(a){return c[a.getMonth()]},MM:function(a){return d(a.getMonth()+1)},M:function(a){return a.getMonth()+1},dd:function(a){return d(a.getDate())},d:function(a){return a.getDate()},hh:function(a){var b=a.getHours();return 12===b?"12":d(b%12)},h:function(a){var b=a.getHours();return 12===b?"12":b%12},P:function(a){return a.getHours()<12?"AM":"PM"},HH:function(a){return d(a.getHours())},H:function(a){return a.getHours()},mm:function(a){return d(a.getMinutes())},m:function(a){return a.getMinutes()},ss:function(a){return d(a.getSeconds())},s:function(a){return a.getSeconds()},DDDD:function(b){return a[b.getDay()]},DDD:function(b){return a[b.getDay()].substring(0,3)},D:function(a){return a.getDay()}};return{now:Date.now,format:function(a,b){var c=a||"yyyy-MM-dd hh:mm:ss DD",d=b||new Date;return c.replace(/yyyy|yy|MMMM|MMM|MM|dd|d|hh|h|P|HH|H|mm|m|ss|s|DDDD|DDD|D/g,function(a){return e[a](d)})}}}(),function(a){function b(a){return function(b){var c=a(b);return EXPORT.approximate(c,0)?0:c}}a.math={approximate:function(a,b,c){c=c||1e-10;var d=a-b;return c>d&&d>-c},square:function(a){return a*a},sin:b(Math.sin),cos:b(Math.cos),tan:b(Math.tan),cot:function(a){var b=Math.tan(a);return b>1e10||-1e10>b?0:1/b},zero:function(){return 0},one:function(){return 1},and:function(){var a,b=!!arguments[0];for(a=1;a<arguments.length;a++)b=b&&arguments[a];return b},or:function(){var a,b=!!arguments[0];for(a=1;a<arguments.length;a++)b=b||arguments[a];return b},not:function(a){return!a},square:function(a){return a*a},plus:function(){var a=arguments[0]||0;for(i=1;i<arguments.length;i++)a+=arguments[i];return a},multiply:function(){var a=arguments[0]||1;for(i=1;i<arguments.length;i++)a*=arguments[i];return a},divide:function(a,b){return a/b},minus:function(a,b){return a-b},sign:function(a){return 0>a?-1:a>0?1:0}}}(nx),nx.string={camelize:function(a){return a.replace(/-\w/g,function(a){return a.charAt(1).toUpperCase()})},uncamelize:function(a){return a.replace(/[A-Z]/g,function(a){return"-"+a.toLowerCase()})}},function(a){a.sets=function(b,c){for(var d in c)a.path(b,d,c[d])}}(nx),function(a){a.timer=function(a,b){var c={timeout:null,resources:[],again:function(d){c.timeout=setTimeout(function(){clearTimeout(c.timeout),c.timeout=null;var a=b(c.again);a&&c.resources.push(a)},d>=0?d:a)}};return c.again(a),{release:function(){c.timeout&&clearTimeout(c.timeout);for(var a;c.resources.length;)a=c.resources.pop(),a&&"function"==typeof a.release&&a.release()}}}}(nx),nx.serial=function(){var a=1;return function(){return a++}}(),function(a){a.binding=function(b,c,d){return this instanceof a.binding?void(arguments.length&&("function"==typeof b?(d=b,c=!1,b=[]):"boolean"==typeof b?(d=c,c=b,b=[]):"function"==typeof c?(d=c,c=!1):"string"==typeof b||a.is(b,"Array")||(d=b.handler,c=b.async,b=b.paths||[]),"string"==typeof b&&(b=b.replace(/\s/g,"").split(",")),this.paths=b,this.async=c,this.handler=d)):new a.binding(b,c,d)}}(nx),function(a){function b(){this.__id__=a.serial(),this.__listeners__={},this.__watchers__={},this.__resources__={},this.self=this}var c=a.global,d=Object.prototype.hasOwnProperty,e=Array.prototype.slice,f=function(a,b,c){c=c||{};var d,e,f=a.__mixins__||[];for(d=0;d<f.length;d++){if(e=f[d],c[e.__id__]||(c[e.__id__]=!0),e===b||e.prototype instanceof b)return!0;if(isMixin(e,b,c))return!0}},g={constructor:b,__nx__:!0,__class__:b,__namespace__:"nx.Object",__properties__:{},__methods__:{},__mixins__:[],__initializers__:[],global:c,inherited:function(c){var d,e,f=a.is(c,"Arguments")?c:arguments,g=this.inherited.caller,h=g.__super__;return"init"!==g.__name__?h&&h.apply(this,f):(d=h?h.__class__:h=b,this.__type_initialized__[d.__id__]||(this.__type_initialized__[d.__id__]=!0,h.apply(this,f)),e=g.__class__,a.each(e.__mixins__,function(a){this.__type_initialized__[a.__id__]||(this.__type_initialized__[a.__id__]=!0,a.__ctor__.call(this))},this),a.each(e.__initializers__,function(a){a.initialize.call(this)},this),void 0)},retain:function(b,c){if(arguments.length<2)return"string"==typeof b?this.__resources__[b]:this.retain(a.serial(),b);for(this.__resources__[b]&&this.__resources__[b].release();"function"==typeof c;)c=c.call(this);return c&&"function"==typeof c.release?(this.__resources__[b]=c,c):void delete this.__resources__[b]},release:function(b){void 0===b?(this.__released__=!0,a.each(this.__resources__,function(a){a&&a.release()}),this.__resources__={}):this.__resources__[b]&&(this.__resources__[b].release(),delete this.__resources__[b])},on:function(b,c,e){var f=this.__listeners__,g=f[b]=f[b]||{size:0},h=a.serial(),i={owner:this,handler:c,context:e||this};return g[h]=i,g.size++,1===g.size&&i.owner.fire("+"+b),{id:h,release:function(){d.call(g,h)&&(delete g[h],g.size--,g.size||i.owner.fire("-"+b))}}},fire:function(a){var b,c,d=e.call(arguments,1),f=this.__listeners__[a];for(b in f)if(c=f[b],c&&c.handler&&(result=c.handler.apply(c.context,[c.owner].concat(d)),result===!1))return!1},watch:function(b,c,d){if("function"==typeof c){var e=this.__watchers__,f=e[b]=e[b]||{size:0},g=this,h=a.serial(),i=(this[b],f[h]={id:h,owner:this,name:b,handler:c,affect:function(a){i.resource&&i.resource.release();var e,f=g.__get__(b);e=c.call(d||g,b,f,a,g),e&&"function"==typeof e.release&&(i.resource=e)}});return f.size++,i.affect(),{release:function(){i.resource&&i.resource.release(),delete f[h],--f.size||delete e[b]}}}},notify:function(a,b){var c,d=this.__watchers__[a];for(c in d)"size"!==c&&d[c].affect(b)},__is__:function(b){return"string"==typeof b&&(b=a.path(c,b)),"function"==typeof b&&b.__nx__?this instanceof b?!0:f(this.__class__,b)?!0:!1:!1},__has__:function(a){var b=this[a];return b&&"property"==b.__type__},__get__:function(a){var b=this[a];return b&&"property"==b.__type__?b.call(this):b},__set__:function(a,c){var e=this[a];if(e||d.call(this,a)||(b.extendProperty(this,a,{}),e=this[a]),"function"==typeof e&&"property"==e.__type__)return e.call(this,c);throw new Error("Unable to set property: "+a)}};a.extend(b,{prototype:g,__meta__:{},__nx__:!0,__id__:a.serial(),__namespace__:g.__namespace__,__methods__:g.__methods__,__properties__:g.__properties__,__ctor_idle__:!0,__mixins__:[],__initializers__:[],IDLE_RESOURCE:{release:a.idle},extendProperty:function(c,e,f,g){(a.is(f,a.binding)||!a.is(f,"Object"))&&(f={value:f});var h,i,j,k;i="_"+e,j=f.value instanceof a.binding?f.value:!f.dependencies&&!f.async||d.call(f,"value")&&"function"!=typeof f.value?f.value:a.binding({paths:a.is(f.dependencies,"String")?f.dependencies.replace(/\s/g,"").split(","):f.dependencies,async:f.async,handler:"function"==typeof f.value&&f.value});var l=function(){return function(a,b){if(void 0===a&&0===arguments.length)return h.__getter__?h.__getter__.call(this):this[i];var c=h.__getter__?h.__getter__.call(this):this[i];return(h.__equal__?h.__equal__(c,a):c!==a)&&(h.__setter__?h.__setter__.call(this,a,b)!==!1&&this.__watchers__[e]&&this.notify(e,c):(this[i]=a,this.__watchers__[e]&&this.notify(e,c))),a}};if("function"!=typeof c[e])h=l(),a.extend(h,{__type__:"property",__name__:e,__meta__:a.extend({},f),__binding__:j,__getter__:f.get,__setter__:f.set,__equal__:"function"==typeof f.equalityCheck&&f.equalityCheck,__watchers__:"function"==typeof f.watcher?[f.watcher]:[]}),c[e]=h;else{if(d.call(c,e)?h=c[e]:(h=l(),a.extend(h,{__type__:"property",__name__:e,__meta__:a.extend({},f),__binding__:c[e].__binding__,__get__:c[e].__get__,__set__:c[e].__set__,__equal__:c[e].__equal__,__watchers__:c[e].__watchers__.slice()}),c[e]=h),"property"!==h.__type__)return;j&&(h.__binding__=j),f.get&&(f.get.__super__=h.__getter__,h.__getter__=f.get),f.set&&(f.set.__super__=h.__setter__,h.__setter__=f.set),"function"==typeof f.equalityCheck&&(h.__equal__=f.equalityCheck),"function"==typeof f.watcher&&h.__watchers__.push(f.watcher)}return c.__properties__[e]=h.__meta__,k={initialize:function(){var c,g,h=this[e];g="function"==typeof h.__binding__?h.__binding__.call(this):h.__binding__,g instanceof a.binding?(c=b.affectBinding(this,e,g),this.retain(c)):d.call(f,"value")&&h.call(this,g);for(var i,j=h.__watchers__.length,i=0;j>i;i++)this.retain(this.watch(e,h.__watchers__[i]))}},g&&k.initialize.call(c),k},extendMethod:function(a,b,c){a[b]&&"method"==a[b].__type__;a[b]&&a[b]!==c&&(c.__super__=a[b]),c.__name__=b,c.__type__="method",c.__meta__={},a[b]=c,a.__methods__[b]=c},binding:function(c,d,f,g){if(!d)return b.IDLE_RESOURCE;var h,i=new b;return h=a.extend({},g,{set:function(d,e){return i.release("recursive"),d instanceof a.binding?void i.retain("recursive",b.binding(c,d,f,g)):f.call(c,d,e)}}),d.paths&&d.paths.length?d.async&&d.handler?i.retain(b.cascade(c,d.paths,function(){var a=e.call(arguments);a.unshift(h),i.retain("async",d.handler.apply(c,a))})):i.retain(b.cascade(c,d.paths,function(a){h.set(d.handler?d.handler.apply(c,arguments):a)})):d.async&&d.handler?i.retain("async",d.handler.call(c,h)):h.set(d.handler?d.handler.call(c):a.path(c,d.paths[0])),i},affectBinding:function(a,c,d){var e=a[c];return e?b.binding(a,d,e,{get:e.bind(a)}):b.IDLE_RESOURCE},watch:function(b,c,d,e){var f="string"==typeof c?c.replace(/\s/g,"").split("."):c,g=function(f,h,i){return f?i.length?a.is(f,a.Object)?f.watch(i[0],function(a,b,c){return g(b,c,i.slice(1))}):g(a.path(f,i[0]),a.path(h,i[0]),i.slice(1)):d.call(e||b,c,f,h):d.call(e||b,c,f,a.path(h,i))};return g(b,void 0,f)},cascade:function(c,d,e,f){if(c&&d&&e){var g,h,i=new a.Object;g="string"==typeof d?d.replace(/\s/g,"").split(","):d,h=[];var j=function(a,b){var d=h.slice();a&&d.push(a,b),e.apply(f||c,d)};return a.each(g,function(b,d){h[d]=a.path(c,b)}),a.each(g,function(a,d){i.retain(b.watch(c,g[d],function(a,b){var c=h[d];c!==b&&(h[d]=b,j(g[d],c))}))}),j(null,null),i}}}),a.Object=b}(nx),function(nx){function define(pathname,parent,meta){var Class,classname;if(meta?parent||(parent=nx.Object):parent?"string"!=typeof pathname?(meta=parent,parent=pathname,pathname=null):(meta=parent,parent=nx.Object):(meta=pathname||{},parent=nx.Object,pathname=null),meta&&meta["static"])return meta=nx.extend({},meta),delete meta["static"],singleton(pathname,parent,meta);Class=function(a){if(!this instanceof arguments.callee)return nx.factory(arguments.callee,arguments);if(!(a instanceof nx.idle)){var b=arguments[0];"[object Arguments]"!==Object.prototype.toString.call(b)&&(b=arguments),this.__initializing__=!0,this.__type_initialized__={},this.__ctor__.apply(this,b),delete this.__type_initialized__,this.__initializing__=!1}},nx.TEXTUAL&&(classname=pathname?pathname.split(".").pop():"Anonymous",nx.define.cutpoint=nx.define.cutpoint||function(){}.toString().indexOf("("),Class=eval(["(function ",classname,Class.toString().substring(nx.define.cutpoint),")"].join("")));var prototype,mixins,initializers,init,init_meta,init_super;return mixins=parent.__ctor_idle__?parent.__mixins__.slice():[],mixins=nx.is(meta.mixins,"Array")?mixins.concat(meta.mixins):mixins.concat("function"==typeof meta.mixins?[meta.mixins]:[]),initializers=parent.__ctor_idle__?parent.__initializers__.slice():[],init_super=parent.__ctor__&&parent.__ctor_idle__?parent.__ctor__.__super__:parent.__ctor__,init_meta=init=meta.methods&&meta.methods.init,init||(init=function(){this.inherited(arguments)}),nx.extend(init,{__type__:"method",__name__:"init",__class__:Class,__super__:init_super}),prototype=function(){var a=function(){};return a.prototype=parent.prototype,new a}(),nx.extend(prototype,{constructor:Class,__nx__:!0,__class__:Class,__super__:parent,__ctor__:init,__properties__:nx.extend({},prototype.__properties__),__methods__:nx.extend({},prototype.__methods__),__mixins__:prototype.__mixins__.slice()}),nx.extend(Class,meta.statics),nx.extend(Class,{prototype:prototype,__nx__:!0,__id__:nx.serial(),__meta__:meta,__super__:prototype.__super__,__ctor__:init,__ctor_idle__:!init_meta,__mixins__:mixins,__initializers__:initializers}),apply_meta(Class,meta),pathname&&(Class.__namespace__=pathname,prototype.__namespace__=pathname,nx.path(nx.global,pathname,Class)),Class}function singleton(a,b,c){var d=define(b,c),e=new d;return a&&nx.path(nx.global,a,e),e}var global=nx.global,apply_meta=function(a,b){var c=b.mixins;nx.is(c,"Array")||(c="function"==typeof c?[c]:[]);var d=a.prototype;nx.each(c,function(b){-1===d.__mixins__.indexOf(b)&&(d.__mixins__.push(b),apply_meta(a,b.__meta__))}),nx.each(b.methods,function(a,b){"init"!==b&&nx.Object.extendMethod(d,b,a)}),nx.each(b.properties,function(b,c){var e=nx.Object.extendProperty(d,c,b);a.__initializers__.push(e)})};nx.define=define,nx.singleton=singleton}(nx),function(a){var b=Object.prototype.toString,c=Object.prototype.hasOwnProperty,d=a.define("nx.Map",{methods:{init:function(b){if(this.inherited(),this._nummap={},this._strmap={},this._nxomap={},this._objmap=[],a.is(b,d))b.each(function(a,b){this.set(b,a)},this);else{var c;for(c in b)this.set(c,b[c])}},clear:function(){delete this._undefined,delete this._null,delete this._true,delete this._false,this._nummap={},this._strmap={},this._nxomap=[],this._objmap=[],this.fire("change",{action:"clear"})},has:function(a){if(null===a)return c.call(this,"_null");if(void 0===a)return c.call(this,"_undefined");switch(b.call(a)){case"[object Null]":return c.call(this,"_null");case"[object Boolean]":return c.call(this,a?"_true":"_false");case"[object Undefined]":return c.call(this,"_undefined");case"[object Number]":return c.call(this._nummap,a);case"[object String]":return c.call(this._strmap,a);default:return a.__id__?c.call(this._nxomap,a.__id__):!!d.getArrayMapItem(this._objmap,a)}},remove:function(a){var c=this.get(a);if(null===a)delete this._null;else if(void 0===a)delete this._undefined;else switch(b.call(a)){case"[object Null]":delete this._null;case"[object Undefined]":return this._undefined;case"[object Boolean]":a?delete this._true:delete this._false;case"[object Number]":delete this._nummap[a];case"[object String]":delete this._strmap[a];default:a.__id__?delete this._nxomap[a.__id__]:d.removeArrayMapItem(this._objmap,a)}return this.fire("change",{action:"remove",key:a,previousValue:c}),c},get:function(a){if(null===a)return this._null;if(void 0===a)return this._undefined;switch(b.call(a)){case"[object Null]":return this._null;case"[object Boolean]":return a?this._true:this._false;case"[object Undefined]":return this._undefined;case"[object Number]":return this._nummap[a];case"[object String]":return this._strmap[a];default:return a.__id__?(this._nxomap[a.__id__]||{}).value:d.getArrayMapValue(this._objmap,a)}},set:function(a,c){var e=this.get(a);if(e===c)return c;if(null===a)this._null=c;else if(void 0===a)this._undefined=c;else switch(b.call(a)){case"[object Null]":this._null=c;break;case"[object Boolean]":a?this._true=c:this._false=c;break;case"[object Undefined]":this._undefined=c;break;case"[object Number]":this._nummap[a]=c;break;case"[object String]":this._strmap[a]=c;break;default:a.__id__?this._nxomap[a.__id__]={key:a,value:c}:d.setArrayMapValue(this._objmap,a,c)}return this.fire("change",{action:"set",key:a,previousValue:e,value:c}),c},each:function(a,b){if(c.call(this,"_undefined")&&a.call(b,this._undefined,void 0)===!1)return!1;if(c.call(this,"_null")&&a.call(b,this._null,null)===!1)return!1;if(c.call(this,"_true")&&a.call(b,this._true,!0)===!1)return!1;if(c.call(this,"_false")&&a.call(b,this._false,!1)===!1)return!1;var d,e,f;for(d in this._nummap)if(a.call(b,this._nummap[d],Number(d))===!1)return!1;for(d in this._strmap)if(a.call(b,this._strmap[d],d)===!1)return!1;for(d in this._nxomap)if(e=this._nxomap[d],a.call(b,e.value,e.key)===!1)return!1;for(d=0,f=this._objmap.length;f>d;d++)if(e=this._objmap[d],a.call(b,e.value,e.key)===!1)return!1},monitor:function(b,c){var d=this,e=new a.Map,f=d.on("change",function(a,d){var f;switch(d.action){case"set":f=e.get(d.key),f&&f.release(),f=b.call(c,d.key,d.value,d.previousValue),f&&e.set(d.key,{release:f});break;case"remove":f=e.get(d.key),f&&f.release();break;case"clear":e.each(function(a,b){a&&a.release()}),e.clear()}});return d.each(function(a,d){var f=b.call(c,d,a);f&&e.set(d,f)}),{release:function(){f&&(e.each(function(a,b){a&&a.release()}),e.clear(),f.release(),f=null)}}},cascade:function(b,c,d){"string"==typeof b&&(b=b.replace(/\s/g,"").split(","));var e;e=[],a.each(b,function(a){e.push(this.get(a))},this);var f=this.on("change",function(a,f){var g,h;switch(f.action){case"set":case"remove":g=b.indexOf(f.key),g>=0&&e[g]!==f.value&&(e[g]=f.value,h=e.slice(),h.push(f.key,f.previousValue),c.apply(d,h));break;case"clear":c.call(d)}});return c.apply(d,e),{release:function(){f&&(f.release(),f=null)}}},__each__:function(a,b){return this.each(a,b)},__get__:function(a){return this[a]&&"property"===this[a].__type__?this[a].call(this):this.get(a)},__set__:function(a,b){return this[a]&&"property"===this[a].__type__?this[a].call(this,b):this.set(a,b)}},statics:{getArrayMapItem:function(a,b){return a.filter(function(a){return a.key===b})[0]},removeArrayMapItem:function(b,c){a.each(b,function(a,d){return a.key===c?(b.splice(d,1),!1):void 0})},getArrayMapValue:function(a,b){return(d.getArrayMapItem(a,b)||{}).value},setArrayMapValue:function(a,b,c){var e=d.getArrayMapItem(a,b);return e?e.value=c:a.push({key:b,value:c}),c}}})}(nx),function(a){a.define("nx.Counter",a.Map,{methods:{init:function(){this.inherited(arguments),this.on("change",function(a,b){var c=b.previousValue||0,d=b.value||0,e={item:b.key,previousCount:c,count:d};d>c&&this.fire("increase",e),c>d&&this.fire("decrease",e),this.fire("count",e)})},get:function(a){return this.inherited(a)||0},increase:function(a,b){b=arguments.length>1?Math.floor(1*b||0):1;var c=this.get(a)+b;return c?this.set(a,this.get(a)+b):(this.remove(a),0)},decrease:function(a,b){b=arguments.length>1?Math.floor(1*b||0):1;var c=this.get(a)-b;return c?this.set(a,c):(this.remove(a),0)}}})}(nx),function(a){var b=(a.global,Array.prototype.splice),c=Array.prototype.slice,d=Object.prototype.hasOwnProperty,e=Math.sign||a.math.sign,f=/^(&&|\|\||&|\||\^|-|\(|\)|[a-zA-Z\_][a-zA-Z\d\_]*|\s)*$/,g=/&&|\|\||&|\||\^|-|\(|\)|[a-zA-Z\_][a-zA-Z\d\_]*/g,h=/[a-zA-Z\_][a-zA-Z\d\_]*/,i=/&&|\|\||&|\||\^|-|\(|\)/,j={"-":"complement","&":"cross","^":"delta","|":"union","&&":"and","||":"or"},k=a.define("nx.List",{properties:{length:{set:function(){throw new Error("Unable to set length of List")}},data:{set:function(){throw new Error("Unable to set data of List")}}},methods:{init:function(b){this.inherited(),this._counting_map=new a.Counter,this._counting_num=0,this._counting_res=null,this._length=0,this._data=[],a.is(b,"Array")?this.spliceAll(0,0,b.slice()):a.is(b,k)&&this.spliceAll(0,0,b._data.slice())},toArray:function(){return this._data.slice()},slice:function(a,b){return new k(c.call(this._data,a,b))},get:function(a){return a>=0?this._data[a]:0>a?this._data[this._data.length+a]:void 0},each:function(b,c){return a.each(this._data,b,c)},__each__:function(b,c){return a.each(this._data,b,c)},contains:function(a){return this._data.indexOf(a)>=0},indexOf:function(a,b){return this._data.indexOf(a,b)},lastIndexOf:function(a,b){return void 0===b?this._data.lastIndexOf(a):this._data.lastIndexOf(a,b)},find:function(a){if(this._data.find)return this._data.find(a);var b;for(b=0;b<this._data.length;b++)if(a(this._data[b]))return this._data[b]},findIndex:function(a){if(this._data.find)return this._data.findIndex(a);var b;for(b=0;b<this._data.length;b++)if(a(this._data[b]))return b;return-1},push:function(){return this.spliceAll(this._data.length,0,c.call(arguments)),this._data.length},pushAll:function(a){return this.spliceAll(this._data.length,0,a),this._data.length},pop:function(){return this.spliceAll(this._data.length-1,1,[])[0]},unshift:function(){return this.spliceAll(0,0,c.call(arguments)),this._data.length},unshiftAll:function(a){return this.spliceAll(0,0,a),this._data.length},shift:function(){return this.spliceAll(0,1,[])[0]},splice:function(a,b){return this.spliceAll(a,b,c.call(arguments,2))},spliceAll:function(a,b,c){0>a&&(a=this._length+a),0>b&&(b=0),a+b>this._length&&(a>this._length&&(a=this._length),b=this._length-a);var d=this.differ([["splice",a,b,c]]);return d.drops[0]},remove:function(){return this.removeAll(c.call(arguments))},removeAll:function(a){if(!a)return this.clear().length;var b,c,d,e=0,f=[];for(b=0;b<a.length;b++)for(d=a[b];(c=this.indexOf(d,c+1))>=0;)f.push(["splice",c,1,[]]),e++;return f.sort(function(a,b){return b[1]-a[1]}),this.differ(f),e},clear:function(){var a=this.differ([["splice",0,this._length,[]]]);return a.drops[0]},toggle:function(a,b){return arguments.length>1?(b?this.indexOf(a)<0&&this.push(a):this.remove(a),b):this.indexOf(a)>=0?(this.remove(a),!1):(this.push(a),!0)},setIndex:function(a,b){var c=this.indexOf(a);if(-1===c){var d=this.differ([["splice",b,0,[a]]]);return d.diffs[0][1]}return c+this.move(c,1,b-c)},setIndexAt:function(a,b){var c=this._length;return 0>a&&(a=c+a),0>a||a>=c?0:a+this.move(a,1,b-a)},move:function(a,b,c){var d=this._length;return 0>a&&(a=d+a),0>a||a>=d?0:(a+b>d?b=d-a:0>b&&(0>a+b?(b=a,a=0):(b=-b,a-=b)),0>=b?0:(a+b+c>d?c=d-a-b:0>a+c&&(c=-a),0===c?0:(this.differ([["move",a,b,c]]),c)))},differ:function(a){var b=this._length,c=this._differ(a);return c&&c.diffs.length&&(this.fire("diff",c),b!==this._data._length&&(this._length=this._data.length,this.notify("length"))),c},_differ:function(c){var d=[],e=[];return a.each(c,function(c){switch(c[0]){case"splice":d.push(a.func.apply(b,this._data,c[1],c[2],c[3])),e.push(c[3]);break;case"move":a.func.apply(b,this._data,c[1]+c[3],0,this._data.splice(c[1],c[2])),d.push([]),e.push([])}},this),{diffs:c||[],drops:d,joins:e}},_counting_register:function(){this._counting_num++;var b=this._counting_map;return this._counting_num>0&&(this._counting_res||(b.clear(),a.each(this._data,function(a){b.increase(a)}),this._counting_res=this.on("diff",function(c,d){var e,f,g,h,i,j,k,l=new a.Counter;for(i=d.diffs,j=d.drops,k=d.joins,e=0;e<i.length;e++)f=i[e],g=j[e],h=k[e],a.each(g,function(a){l.decrease(a)}),a.each(h,function(a){l.increase(a)});var m=[];l.each(function(a,c){(a>0||0>a)&&(b.increase(c,a),m.push({value:c,count:b.get(c)}))}),this.fire("counting",m)},this))),{release:function(){this._counting_num--,this._counting_num<=0&&this._counting_res&&(this._counting_res.release(),this._counting_res=null)}.bind(this)}},monitorDiff:function(a,b){var c=this,d=this._data.slice();d.length&&a.call(b,{diffs:Array(["splice",0,0,d]),drops:Array([]),joins:[d]});var e=this.on("diff",function(c,d){a.call(b,d)});return{release:function(){if(e){var d=c._data.slice();d.length&&a.call(b,{diffs:Array(["splice",0,d.length,[]]),drops:[d],joins:Array([])}),e.release()}}}},monitorContaining:function(b,c){var d=(this._counting_map,new a.Map),e=function(a,b){"function"==typeof b&&(b={release:b}),b&&"function"==typeof b.release&&d.set(a,b)},f=this._counting_register(),g=this.on("counting",function(f,g){a.each(g,function(a){var f,g=d.get(a.value);g?a.count<=0&&(g.release(),d.remove(a.value)):a.count>0&&(f=b.call(c,a.value),e(a.value,f))})},this);return a.each(this._data,function(a){var d=b.call(c,a);e(a,d)},this),{release:function(){g&&(d.each(function(a,b){a.release()}),d.clear(),g.release(),g=null),f&&(f.release(),f=null)}}},monitorCounting:function(b,c){var d=this._counting_map,e=new a.Map,f=this._counting_register(),g=this.on("counting",function(d,f){a.each(f,function(a){var d=e.get(a.value);d?(d(a.count),a.count<=0&&e.remove(a.value)):a.count>0&&(d=b.call(c,a.value,a.count),d&&e.set(a.value,d))})},this);return a.each(d,function(a,d){var f=b(c,a,d);f&&e.set(a,f)},this),{release:function(){g&&(e.each(function(a,b){a(0)}),e.clear(),g.release(),g=null),f&&(f.release(),f=null)}}}},statics:{getListSyncMonitor:function(a,b){return b!==!1?function(b){return a.push(b),function(){a.remove(b)}}:function(b){return a.remove(b),function(){a.push(b)}}},buildExpressionTree:function(){var a=[["-"],["&"],["^"],["|"],["&&"],["||"]],b=function(b){for(var c=0;c<a.length;c++)if(a[c].indexOf(b)>=0)return c},c=function(a,b,c){return"[object Array]"===Object.prototype.toString.call(b)&&b[0]===a?(b.push(c),b):[a,b,c]};return function(a){"string"==typeof a&&(a=a.match(g)),a=a.concat([")"]);for(var d,e,f,j=[],k=[],l=[];a.length;)if(d=a.shift(),
")"===d)for(;(e=j.pop())&&"("!==e;)f=k.pop(),k.push(c(e,k.pop(),f));else if("("===d)j.push(d);else if(d.match(h))k.push(d),-1==l.indexOf(d)&&l.push(d);else if(d.match(i)){for(;j.length;){if(e=j.pop(),"("===e||b(e)>b(d)){j.push(e);break}f=k.pop(),k.push(c(e,k.pop(),f))}j.push(d)}return k[0]&&(k[0].operands=l),k[0]}}(),calculate:function(b,c){if(!b.match(f))throw new Error("Bad expression.");a.is(c,a.Map)||(c=new a.Map(c));var d=b.match(g),e=d.filter(RegExp.prototype.test.bind(h)),i=k.buildExpressionTree(d),j=new a.List,l={count:0,map:{},sync:function(){if(l.count===e.length){var a;"string"==typeof i?a=c.get(i):(j.retain(a),a=k.calculateTree(i,c)),j.retain(a.monitorContaining(k.getListSyncMonitor(j)))}},monitor:function(a,b){e.indexOf(a)>=0&&(l.count+=1*!l.map[a]+1*!!b-1,l.map[a]=b,l.sync())}};return j.retain(c.monitor(l.monitor)),j},calculateTree:function(b,c){var d,e,f=b[0];switch(f){case"&&":d=new a.List,e=function(f){var g,h;return"string"==typeof b[f]?(g=c.get(b[f]),h=new a.Object):h=g=k.calculateTree(b[f],c),f>=b.length-1?h.retain(g.monitorContaining(k.getListSyncMonitor(d))):h.retain(g.watch("length",function(a,b){return b?e(f+1):void 0})),h},d.retain(e(1));break;case"||":d=new a.List,e=function(f){var g,h;return"string"==typeof b[f]?(g=c.get(b[f]),h=new a.Object):h=g=k.calculateTree(b[f],c),f>=b.length-1?h.retain(g.monitorContaining(k.getListSyncMonitor(d))):h.retain(g.watch("length",function(a,b){return b?g.monitorContaining(k.getListSyncMonitor(d)):e(f+1)})),h},d.retain(e(1));break;default:d=function(){var d,e,g,h=[],i=[];for(e=1;e<b.length;e++)"string"==typeof b[e]?g=c.get(b[e]):(g=k.calculateTree(b[e],c),h.push(g)),i.push(g);return d=k[j[f]](i),a.each(h,function(a){d.retain(a)}),d}()}return d},select:function(b,c,d){if(!a.is(b,k))return null;"function"==typeof c&&(d=c,c=null),d||(d=a.identity);var e=new k;return e.retain(b.monitorContaining(function(b){var f;return c?a.is(b,a.Object)?f=a.Object.cascade(b,c,function(){e.toggle(b,d.apply(e,arguments))}):e.toggle(b,d.call(e,a.path(b,c))):e.toggle(b,d.call(e,b)),function(){f&&f.release(),e.toggle(b,!1)}})),e},summarize:function(b,c){return sum=0,b.monitorDiff(function(b){a.each(b.diffs,function(c,d){var e=b.drops[d],f=b.joins[d],g=a.math.plus.apply(this,f)-a.math.plus.apply(this,e);g&&(sum+=g)}),c(sum)})},sorting:function(a,b){},mapping:function(c,e,f,g){var h=a.binding(e,f,g),i=new k,j={listeners:[],shift:function(a,b){var c;for(c=a;c<j.listeners.length;c++)j.listeners[c].index+=b},listen:function(b,c){var e,f;return e={index:c,set:function(a){d.call(e,"value")&&i.splice(e.index,1,a),e.value=a},release:function(){f&&f.release(),f=null,e.value&&"function"==typeof e.value.release&&e.value.release()}},h.paths&&h.paths.length?f=a.Object.binding(b,h,function(a){e.set(a)}):h.async?h.handler({get:function(){return e.value},set:e.set},b):e.set(h.handler(b)),e},release:function(){a.each(j.listeners,function(a){a.release()})},move:function(c,d,e){var f,g,h=j.listeners,i=[[c,d,e],e>0?[c+d,e,-d]:[c+e,-e,d]];a.each(i,function(a){for(f=0;f<a[1];f++)g=h[a[0]+f],g.index+=a[2]}),a.func.apply(b,j.listeners,c+e,0,j.listeners.splice(c,d))}};return c.each(function(a,b){var c=j.listen(a,b);i.push(c.value),j.listeners.push(c)}),i.retain(j),i.retain(c.on("diff",function(c,d){var e=[];a.each(d.diffs,function(c,f){var g,h,i,k,l;switch(c[0]){case"splice":i=c[1],g=d.drops[f],h=d.joins[f],l=h.map(function(a,b){return j.listen(a,i+b)}),k=l.map(function(a){return a.value}),j.shift(i+g.length,h.length-g.length),g=a.func.apply(b,j.listeners,i,g.length,l),a.each(g,function(a){a.release()}),e.push(["splice",i,g.length,k]);break;case"move":j.move(c[1],c[2],c[3]),e.push(c.slice())}}),e.length&&i.differ(e)})),i},tuple:function(c,d,e,f){var g=new a.List,h={tuples:[],resources:[],changed:null,lock:function(a){h.changed=[],a(),h.changed=null},shift:function(a){}};return g.retain(c.on("diff",function(c,d){var e=[];a.each(d.diffs,function(c,f){var g,i,j,k,l;switch(c[0]){case"splice":j=c[1],g=d.drops[f],i=d.joins[f],l=i.map(function(a,b){return h.listen(a,j+b)}),k=l.map(function(a){return a.value}),h.shift(j+g.length,i.length-g.length),g=a.func.apply(b,h.listeners,j,g.length,l),a.each(g,function(a){a.release()}),e.push(["splice",j,g.length,k]);break;case"move":h.move(c[1],c[2],c[3]),e.push(c.slice())}}),e.length&&g.differ(e)})),g},mapeach:function(c,d,f){"string"!=typeof d&&(f=d,d="$origin");var g=new a.List;f=function(b){var c,e={};if(a.each(b,function(b,f){var g={};if(!a.is(b,a.binding))if(a.is(b,"String")||a.is(b,"Function"))b=a.binding(b);else if(a.is(b,"Array"))b=a.binding.apply(b);else{if(!b.paths&&!b.handler)throw new Error("Malformed mapping definition");b=a.binding(b)}"$origin"===d&&b.paths&&(b.paths=b.paths.map(function(a){return d+"."+a})),"+"===f.charAt(0)?(g.summarize="0",f=f.substring(1)):"+"===f.charAt(f.length-1)&&(g.summarize="1",f=f.substring(0,f.length-1)),g.binding=b,g.path=f,e[f.replace(/\./g,"\\$")]=g,c=!0}),!c&&"$origin"===d)throw new Error("Missing mapping definition.");return e}(f);var h,i=function(){var b={};return b.index=-1,b[d]=null,a.each(f,function(a,c){var d={};d.value=a.binding,b[c+"$value"]=d,a.summarize&&(d.watcher=function(a,b,d){this._index>=0&&h.shift(this._index+1,c,(b||0)-(d||0))},b[c+"$sum"]=null)}),"$origin"!==d&&a.each(f,function(a,c){-1===c.indexOf("$")&&(b[c]=null)}),a.define({properties:b})}();return h={values:[],resources:[],locked:!1,create:function(a){var b=new i;return b[d].call(b,a),b},lock:function(a){h.locked=!0,a(),h.locked=!1},shift:function(a,b,c){if(!h.locked){var d,e,f;for(d=a;d<h.resources.length;d++)e=h.resources[d],f=e["_"+b+"$sum"],e[b+"$sum"].call(e,f+c)}},splice:function(c,d,e,g,i){var j,k,l,m,n=(a.func.apply(b,h.values,c,d,g),a.func.apply(b,h.resources,c,d,e));for(a.each(e,function(a,b){a.index(c+b)}),k=e.length-n.length,l={},a.each(f,function(b,d){var f,g,i,j=b.summarize;j&&(i=h.resources[c-1],f=i?i["_"+d+"$sum"]:0,g=i?i["_"+d+"$value"]:0),a.each(n,function(a){j&&(l[d]=l[d]||0,l[d]-=a["_"+d+"$value"]||0)}),a.each(e,function(a,b){j&&(l[d]=l[d]||0,l[d]+=a["_"+d+"$value"]||0,f+=g,g=a["_"+d+"$value"],a[d+"$sum"].call(a,f))})}),i(n),a.each(f,function(b,c){var d=b.path,f=b.summarize;a.each(e,function(b,e){var h=g[e];-1!==c.indexOf("$")||h[c]||a.Object.extendProperty(h,c,{});var i=function(){switch(f){case"0":return a.binding(c+"$sum");case"1":return a.binding(c+"$value,"+c+"$sum",function(a,b){return a+b});default:return a.binding(c+"$value")}}();b.retain(a.Object.binding(b,i,function(b){a.path(h,d,b)}))})}),j=c+e.length;j<h.resources.length;j++)m=h.resources[j],m.index(m.index()+k),a.each(l,function(a,b){var c=m["_"+b+"$sum"];m[b+"$sum"].call(m,c+a)})},move:function(c,d,g){var i,j=[[c,d,g,{}],g>0?[c+d,g,-d,{}]:[c+g,-g,d,{}]];a.each(j,function(b,c){var d,e,g=h.resources;for(d=0;d<b[1];d++)e=g[b[0]+d],a.each(f,function(a,c){a.summarize&&(b[3][c]=(b[3][c]||0)+e["_"+c+"$value"])})}),i=j[0][3],j[0][3]=j[1][3],j[1][3]=i,a.each(j,function(b,c){var d,f,g=e(b[2]),i=h.resources;for(d=0;d<b[1];d++)f=i[b[0]+d],f.index(f._index+b[2]),a.each(b[3],function(a,b){var c=f["_"+b+"$sum"];f[b+"$sum"].call(f,c+g*a)})}),a.func.apply(b,h.resources,c+g,0,h.resources.splice(c,d))}},g.retain(c.monitorDiff(function(b){var c=[];a.each(b.diffs,function(e,f){switch(e[0]){case"splice":var g=e[1],i=b.drops[f],j=b.joins[f],k=j.map(h.create),l=j.map(function(a,b){return"$origin"===d?a:k[b]});h.lock(function(){h.splice(g,i.length,k,l,function(b){a.each(b,function(a){a.release()})})}),(i.length||l.length)&&e&&c.push(["splice",g,i.length,l]);break;case"move":h.lock(function(){h.move(e[1],e[2],e[3])}),c.push(e.slice())}}),c.length&&g.differ(c)})),g},concatenate:function(c,d){"boolean"!=typeof c&&(d=c,c=!1),a.is(d,"Array")&&(d=new k(d));var f=new k,g={diffs:[],resources:[],affect:function(){f.differ(g.diffs||[]),g.diffs=[]},differ:function(a,b){g.diffs=g.diffs.concat(a),c&&!b||g.affect()},shift:function(a,b,c){var d;for(d=a;d<g.resources.length;d++)g.resources[d].index+=b,g.resources[d].start+=c},create:function(b){var c=new a.Object;return c.retain(b.on("diff",function(a,b){c.differ(b.diffs)})),c.differ=function(a){a=a.slice();var b,d,e=0;for(b=0;b<a.length;b++)switch(d=a[b]=a[b].slice(),d[1]+=c.start,d[0]){case"splice":e-=d[2],e+=d[3].length;break;case"move":}c.length+=e,e&&g.shift(c.index+1,0,e),g.differ(a)},c},splice:function(c,d,e,f,h){var i,j,k,l,m,n=a.func.apply(b,g.resources,c,d,e);return m=l=g.resources[c-1]?g.resources[c-1].start+g.resources[c-1].length:0,i=e.length-n.length,j=0,k=[],a.each(n,function(a){j+=a.length}),a.each(e,function(a,b){var d=f[b];a.index=c+b,a.start=m,a.length=d.length(),m+=a.length,k=k.concat(d.data())}),h(n),(i||k.length-j)&&g.shift(c+e.length,i,k.length-j),j||k.length?["splice",l,j,k]:void 0},move:function(c,d,f){var h,i=g.resources,j=i[c].start,k=[[c,d,f,0],f>0?[c+d,f,-d,0]:[c+f,-f,d,0]];return a.each(k,function(a,b){var c,d,e=g.resources;for(c=0;c<a[1];c++)d=e[a[0]+c],a[3]+=d.length}),h=k[0][3],k[0][3]=k[1][3],k[1][3]=h,a.each(k,function(a,b){var c,d,f=e(a[2]),h=g.resources;for(c=0;c<a[1];c++)d=h[a[0]+c],d.index+=a[2],d.start+=f*a[3]}),a.func.apply(b,g.resources,c+f,0,g.resources.splice(c,d)),k[0][3]&&k[1][3]?["move",j,k[1][3],e(f)*k[0][3]]:void 0},release:function(){g.affect(),a.each(g.resources,function(a){a.release()})}};return f.retain(g),f.retain(d.monitorDiff(function(b){var c=[];a.each(b.diffs,function(d,e){var f,h,i,j;switch(d[0]){case"splice":var f=d[1],h=b.drops[e],i=b.joins[e],j=i.map(g.create);d=g.splice(f,h.length,j,i,function(b){a.each(b,function(a){a.release()})});break;case"move":d=g.move(d[1],d[2],d[3])}d&&c.push(d)}),c.length&&g.differ(c,!0)})),f},cross:function(b){var c=new a.List,d=new a.Counter;return a.is(b,Array)&&(b=new a.List(b)),c.retain(d.on("increase",function(a,d){d.count==b.length()&&c.push(d.item)})),c.retain(d.on("decrease",function(a,d){d.count==b.length()-1&&c.remove(d.item)})),c.retain(b.monitorContaining(function(a){return a.monitorContaining(function(a){return d.increase(a,1),function(){d.decrease(a,1)}})})),c},union:function(b){var c=new a.List,d=new a.Counter;return a.is(b,Array)&&(b=new a.List(b)),c.retain(d.on("increase",function(a,b){1===b.count&&c.push(b.item)})),c.retain(d.on("decrease",function(a,b){0===b.count&&c.remove(b.item)})),c.retain(b.monitorContaining(function(a){return a.monitorContaining(function(a){return d.increase(a,1),function(){d.decrease(a,1)}})})),c},complement:function(b){var c=new a.List,d=new a.Counter,e=b.length;return c.retain(d.on("count",function(a,b){var d=b.previousCount,f=b.count;e>d&&f>=e&&c.push(b.item),d>=e&&e>f&&c.remove(b.item)})),c.retain(b[0].monitorContaining(function(a){return d.increase(a,e),function(){d.decrease(a,e)}})),a.each(b,function(a,b){b>0&&c.retain(a.monitorContaining(function(a){return d.decrease(a),function(){d.increase(a)}}))}),c},delta:function(b){var c=new a.List;return a.each(b,function(a){c.retain(a.monitorContaining(function(a){return c.toggle(a),function(){c.__released__||c.toggle(a)}}))}),c},and:function(b){var c=new a.List,d=function(a){var e=b[a];return a===b.length-1?e.monitorContaining(function(a){return c.push(a),function(){c.__released__||c.remove(a)}}):e.watch("length",function(b,c){return c?d(a+1):void 0})};return c.retain(d(0)),c},or:function(b){var c=new a.List,d=function(a){var e=b[a];return e.watch("length",function(f,g){return a<b.length-1&&!g?d(a+1):e.monitorContaining(function(a){return c.push(a),function(){c.__released__||c.remove(a)}})})};return c.retain(d(0)),c}}})}(nx),function(a){var b=a.array.count;a.define("nx.UniqueList",a.List,{methods:{init:function(a){this.inherited(a),this.retain(this._counting_register())},_differ:function(a){for(c=0;c<a.length;c++){var c,d,e,f,g,h,i=this._data;if(1===a.length){switch(g=a[0],h=this._counting_map,g[0]){case"splice":for(e=g[3],f=i.slice(g[1],g[1]+g[2]),c=e.length;c>=0;c--)d=e[c],h.get(d)+b(e,d)-b(f,d)>1&&(e===g[3]&&(e=e.slice(),a=[["splice",g[1],g[2],e]]),e.splice(c,1))}return a&&a.length?this.inherited(a):null}var j=this.inherited(a);for(c=i.length;c>0;c--)d=i[c],i.indexOf(d)!==c&&(i.splice(c,1),j.diffs===a&&(j.diffs=j.diffs.slice()),j.diffs.push(["splice",c,1,[]]),j.drops.push([d]),j.joins.push([]));return j}return this.inherited(a)}}})}(nx),function(a){a.template=function(b,c,d,e){if(!(this instanceof a.template))return new a.template(b,c,d,e);if(arguments.length){var f;b instanceof a.binding?(f=b,e=c):("function"==typeof b?(e=c,d=b,c=!1,b=[]):"boolean"==typeof b?(e=d,d=c,c=b,b=[]):"function"==typeof c?(e=d,d=c,c=!1):"string"==typeof b||a.is(b,"Array")?"function"==typeof c?(e=d,d=c,c=!1):"boolean"!=typeof c&&(e=c,d=null,c=!1):a.is(b.source,a.binding)?(e=b.pattern,f=b.source):(e=b.pattern,d=b.handler,c=!!b.async,b=b.paths||[]),f||(f=a.binding(b,c,d))),this.binding=f,this.pattern=a.is(e,"Array")?e:[e]}}}(nx),function(a){var b=["name","events","properties","content","extend"],c=/^\{([^\}]*)\}$/,d=/\{([^\}]*)\}/g,e=/\s/g,f=a.define("nx.Hierarchical",{properties:{parent:null,childDefaultType:"nx.Hierarchical",childList:{set:function(){throw new Error("Unable to set child list out of Hierarchical.")},watcher:function(b,c){if(this.release("syncChildList"),a.is(c,a.List)){var d=this;this.retain("syncChildList",c.monitorDiff(function(b){a.each(b.diffs,function(c,e){var g=b.drops[e],h=b.joins[e];a.each(g,function(b){a.is(b,f)&&b.parent(null)}),a.each(h,function(b){a.is(b,f)&&b.parent(d)})})}))}}}},methods:{init:function(){this.inherited(),this._childList=new a.List,this.notify("childList"),this.initHierarchy()},initHierarchy:function(){var c,d=this,e=d.constructor,g=[];do c=e.__meta__.hierarchical,c&&g.unshift(c),e=e.__super__;while(e&&e!==f);a.each(g,function(c){d.__hierarchical__=d.__hierarchical__||{},a.each(c,function(a,c){if(b.indexOf(c)>=0)throw new Error("Cannot use hierarchical keyword: "+c);d.__hierarchical__[c],d.__hierarchical__[c]=a})})},hierarchicalUpdate:function(b,c){var d=this;c=c||d;var e=new a.Object;return b.name&&f.extendProperty(c,b.name,d),a.each(d.__hierarchical__,function(a,f){b[f]&&e.retain(a.call(d,b[f],c))}),a.each(b.events,function(a,b){e.retain(d.hierarchicalUpdateEvent(b,a,c))}),a.each(b.properties,function(a,b){e.retain(d.hierarchicalUpdateProperty(b,a,c))}),e.retain(d.hierarchicalAppend(b.content,c)),a.each(b.extend,function(b,g){var h=a.path(d,g);if(h){if(b.type)throw new Error("Cannot specify type while extending existing self: "+g);e.retain(h.hierarchicalUpdate(b,c))}else h=f.create(d,b),f.extendProperty(d,g,h),e.retain(h.hierarchicalUpdate(b,c))}),e},hierarchicalAppend:function(b,c,d){var e,g,h,i=this;return b||0===b?a.is(b,Array)?i.hierarchicalAppendArray(b,c,d):"string"==typeof b?i.hierarchicalAppendString(b,c,d):"number"==typeof b?i.hierarchicalAppendNumber(b,c,d):a.is(b,f)?i.hierarchicalAppendChildren([b],c,d):b instanceof a.binding?i.hierarchicalAppendBinding(b,c,d):b instanceof a.template||!a.is(b,a.Object)&&b.repeat?(h=f.getTemplateByObject(b)||b,i.hierarchicalAppendTemplate(h,c,d)):(e=f.create(i,b),e.retain(e.hierarchicalUpdate(b,c)),g=i.hierarchicalAppendChildren([e],c,d),{release:function(){g&&(e.release(),g.release(),g=null)}}):a.Object.IDLE_RESOURCE},hierarchicalAppendArray:function(b,c,d){var e=this,f=new a.Object;return a.each(b,function(a){f.retain(e.hierarchicalAppend(a,c,d))}),f},hierarchicalAppendString:function(b,c,d){var e=this;return binding=f.getBindingIfString(b),binding?e.hierarchicalAppendBinding(binding,c,d):a.Object.IDLE_RESOURCE},hierarchicalAppendNumber:function(b,c,d){return a.Object.IDLE_RESOURCE},hierarchicalAppendChildren:function(a,b,c){var d=this;return b=b||d,c=f.getFlatList(d,!0,c),c.spliceAll(c.length(),0,a),{release:function(){a&&(c.remove.apply(c,a),a=null)}}},hierarchicalAppendBinding:function(b,c,d){var e=this;c=c||e,d=f.getFlatList(e,!1,d);var g=new a.Object;return g.retain(a.Object.binding(c,b,function(a){g.release("recursive"),g.retain("recursive",e.hierarchicalAppend(a,c,d))})),g},hierarchicalAppendTemplate:function(b,c,d){var e=this;return c=c||e,d=f.getFlatList(e,!1,d),new a.HierarchicalTemplate(e,d,b,c)},hierarchicalUpdateEvent:function(b,c,d){var e=this,g=new a.Object;return"string"==typeof c&&(c=d[c]&&"method"===d[c].__type__?d[c]:f.getBindingIfString(c,!0)),c&&(a.is(c,a.binding)?g.retain(a.Object.binding(d,c,function(a){g.release("recursive"),g.retain("recursive",e.hierarchicalUpdateEvent(b,a,d))})):"function"==typeof c&&(b=b.indexOf(" ")>=0?b.split(" "):[b],a.each(b,function(a){g.retain(e.on(a,c,d))}))),g},hierarchicalUpdateProperty:function(b,c,d){var e=this;if(d=d||e,c=f.getBindingIfString(c)||c,a.is(c,a.binding)){var g=new a.Object;return a.Object.binding(d,c,function(a){g.release("recursive"),g.retain("recursive",e.hierarchicalUpdateProperty(b,a,d))})}return a.path(e,b,c),a.Object.IDLE_RESOURCE}},statics:{extendProperty:function(b,c,d){if(b[c])throw new Error("Property name conflict: "+c);a.Object.extendProperty(b,c,{},!0),a.path(b,c,d)},create:function(b,c){var d,e;return d="string"==typeof c.type?a.path(global,c.type):c.type,d="function"==typeof d?d:b&&b.childDefaultType&&b.childDefaultType(),d="string"==typeof d?a.path(global,d):d,d=d||f,e=new d},getFlatList:function(b,c,d){d=d||b._childList;var e,f,g;return e=d._concatenate,e?c?(f=e.get(-1),f._flat.plain||(f=new a.List,e.push(f),f._flat={plain:!0,group:e,index:e.length()-1})):(f=new a.List,e.push(f),f._flat={group:e,index:e.length()-1}):c?f=d:(f=new a.List,e=new a.List([d,f]),g=a.List.concatenate(e),g._concatenate=e,d===b._childList?(b._childList=g,b.notify("childList")):d._flat.group.splice(d._flat.index,1,g),d._flat={group:e,index:0},f._flat={group:e,index:1}),f},getStringBindingByString:function(b){if(b.indexOf("{")>=0){if(c.test(b))return a.binding(b.substring(1,b.length-1));var f=[],g={};if(b.replace(d,function(a,b,c){if(b=b.replace(e,"")){-1===f.indexOf(b)&&f.push(b);var d=g[b]=g[b]||[];-1===d.indexOf(a)&&d.push(a)}return""}),f.length)return a.binding(f,function(){var c=arguments,d=b;return a.each(f,function(b,e){var f=c[e];"string"!=typeof f&&"number"!=typeof f&&(f=f?a.is(f,a.Object)?f.__id__:"true":"false"),a.each(g[b],function(a){d=d.replace(a,f)})}),d})}return null},getBindingIfString:function(b,c){if(a.is(b,a.binding))return b;var d=null;return b&&"string"==typeof b&&("{"===b.charAt(0)&&"}"===b.charAt(b.length-1)?d=b.substring(1,b.length-1):c&&(d=b)),d&&a.binding(d)},getTemplateByObject:function(b){if(!b||a.is(b,a.template))return b;var c,d=b.repeat;return a.is(d,a.binding)?c=d:a.is(d,Array)?c=a.binding(function(){return d}):d&&"string"==typeof d&&("{"===d.charAt(0)&&"}"===d.charAt(d.length-1)&&(d=d.substring(1,d.length-1)),c=a.binding(d)),b=a.extend({},b),delete b.repeat,c&&a.template(c,b)}}})}(nx),function(a){var b=a.Hierarchical;a.define("nx.HierarchicalTemplate",{properties:{parent:{},list:{},template:{},context:{}},methods:{init:function(b,c,d,e){this.inherited(),this.parent(b),this.list(c),this.template(d),this.context(e),this.retain(a.Object.cascade(this,"parent,list,template,context",function(a,b,c,d){b&&(this.release("target-list"),this.retain("target-list",b.monitorContaining(function(a){return function(){a.release()}}))),a&&b&&c&&(d=d||a,this.retain("initial",this.applyBinding(a,b,c.binding,c.pattern,d)))}))},applyBinding:function(b,c,d,e,f){var g=this,h=new a.Object;return h.retain(a.Object.binding(f,d,function(i){h.release("recursive"),a.is(i,a.binding)?h.retain("recursive",g.applyBinding(b,c,d,e,f)):a.is(i,a.List)?h.retain("recursive",g.applyList(b,c,i,e,f)):a.is(i,"Array")&&h.retain("recursive",g.applyList(b,c,new a.List(i),e,f))})),h},applyList:function(c,d,e,f,g){g=g||c;var h=a.List.mapeach(e,"model",{count:"list.length",parent:function(){return c},list:function(){return d},context:function(){return g},views:a.binding("parent, context, list, model",function(c,d,e,g){if(c&&d&&e){var h=this;this.release("views");var i=new a.Object;return this.retain("views",i),f.map(function(a){var d=b.create(c,a);return b.extendProperty(d,"scope",h),d.retain(d.hierarchicalUpdate(a,d)),i.retain(d),d})}})});return h.retain(h.monitorDiff(function(b){var c=[];a.each(b.diffs,function(a){var b=a.slice();switch(b[0]){case"splice":b[1]*=f.length,b[2]*=f.length,b[3]=b[3].reduce(function(a,b){return a.concat(b.views())},[]);break;case"move":b[1]*=f.length,b[2]*=f.length,b[3]*=f.length}c.push(b)}),d.differ(c)})),h}}})}(nx),function(a){var b=a.define("nx.geometry.Math",{statics:function(){function a(a){return function(c){var d=a(c);return b.approximate(d,0)?0:d}}return{approximate:function(a,b,c){c=c||1e-10;var d=a-b;return c>d&&d>-c},square:function(a){return a*a},sin:a(Math.sin),cos:a(Math.cos),tan:a(Math.tan),cot:function(a){var b=Math.tan(a);return b>1e10||-1e10>b?0:1/b}}}()})}(nx),function(a){a.define("nx.geometry.Rectangle",{statics:{getBound:function(b,c){a.is(b,"Array")&&(b={x:b[0],y:b[1]}),a.is(c,"Array")&&(c={width:c[0],height:c[1]});var d=c.width>0?b.x:b.x-c.width,e=c.height>0?b.y:b.y-c.height;return{x:d,y:e,left:d,top:e,width:Math.abs(c.width),height:Math.abs(c.height)}},isInside:function(a,b){return a.x>=b.x&&a.y>=b.y&&a.x<=b.x+b.width&&a.y<=b.y+b.height},calcCentralizeMatrix:function(b,c,d,e,f){if(!(c.width>0&&c.height>0&&Math.abs(d.width)&&Math.abs(d.height)))return a.geometry.Matrix.I;var g=d.left||0,h=d.top||0,i=d.width,j=d.height;if(!f){var k=b[0][0],l=b[1][1],m=b[2][0],n=b[2][1];g=g*k+m,h=h*l+n,i*=k,j*=l}var o=c.width-2*e,p=c.height-2*e,q=Math.min(o/Math.abs(i),p/Math.abs(j)),r=e+o/2-q*(g+i/2),s=e+p/2-q*(h+j/2);return[[q,0,0],[0,q,0],[r,s,1]]},calcRectZoomMatrix:function(a,b,c){if(c){var d=b.width||b.height?Math.min(a.height/Math.abs(b.height),a.width/Math.abs(b.width)):1,e=a.width/2-d*(b.left-a.left+b.width/2),f=a.height/2-d*(b.top-a.top+b.height/2);return[[d,0,0],[0,d,0],[e,f,1]]}var d=b.width||b.height?Math.min(a.height/Math.abs(b.height),a.width/Math.abs(b.width)):1,e=a.left+a.width/2-d*(b.left+b.width/2),f=a.top+a.height/2-d*(b.top+b.height/2);return[[d,0,0],[0,d,0],[e,f,1]]}}})}(nx),function(a){var b=Math.sqrt,c=a.math.square,d=Math.abs,e=a.define("nx.geometry.Line",{statics:{getDistance:function(a,d,e,f){return b(c(e-a)+c(f-d))},getPointToSegment:function(a,c,e,f,g,h){var i,j,k,l,m,n,o,p,q,r,s,t,u,v;return e!=g||f!=h?(i=f-h,j=g-e,k=e*h-g*f,m=b(i*i+j*j),l=i*c-j*a,n=i*a+j*c+k,o=j*e-i*f+l,p=j*g-i*h+l,s=d(n)/m,q=-(k*i+j*l)/(i*i+j*j),r=-(k*j-i*l)/(i*i+j*j),o*p>0?d(o)<d(p)?(t=e,u=f,v=b(n*n+o*o)/m):(t=g,u=h,v=b(n*n+p*p)/m):(t=q,u=r,v=s),{pedal:{x:q,y:r,distance:s},closest:{x:t,y:u,distance:v}}):void 0},getPointParameters:function(a){return{x:a.length?a[0]:a.x,y:a.length?a[1]:a.y}},getLineParameters:function(a){if(!a.length)return a;var b=a[0],c=a[1],d=b.length?b[0]:b.x,e=c.length?c[0]:c.x,f=b.length?b[1]:b.y,g=c.length?c[1]:c.y,h=g-f,i=e-d,j=d*g-e*f;return{A:h,B:i,C:j}},getDistanceFromPointToSegment:function(a,b){var a=e.getPointParameters(a),b=e.getLineParameters(b);return(b.A*a.x+b.B*a.y+b.C)/Math.sqrt(b.A*b.A+b.B*b.B)},getPointProjectionOnLine:function(a,b){var a=e.getPointParameters(a),b=e.getLineParameters(b),c=b.A*a.y-b.B*a.x,d=b.A*b.A+b.B*b.B;return{x:-(b.A*b.C+b.B*c)/d,y:-(b.B*b.C-b.A*c)/d}}}})}(nx),function(a){var b=(a.geometry.Math,a.geometry.Vector,a.define("nx.geometry.BezierCurve",{statics:function(){function a(a){var b,c=[];for(b=0;b<a.length-1;b++)c.push([a[b],a[b+1]]);return c}function c(a){var b,c=[a[0][0]];for(b=0;b<a.length;b++)c.push(a[b][1]);return c}function d(a){var b=0,c=0,d=[];for(b=0;b<a.length&&(b!==a.length-1||1!==a[b]);b++){if("number"!=typeof a[b]||a[b]<=c||a[b]>=1)throw"Invalid bread point list: "+a.join(",");d.push((a[b]-c)/(1-c)),c=a[b]}return d}var e=function(){var a=[[],[1],[1,1]];return function(b){if(a[b])return a[b];var c,d=e(b-1),f=[];for(c=0;c<d.length-1;c++)f[c]=d[c]+d[c+1];return f.push(1),f.unshift(1),a[b]=f,f}}();return{slice:function(a,c,d){return 0===c?0===d?null:b.breakdown(a,d).beziers[0]:d?b.breakdown(a,c,d).beziers[1]:b.breakdown(a,c).beziers[1]},breakdown:function(e){var f=Array.prototype.slice.call(arguments,1);if(!f.length)throw"Invalid argument length: "+arguments.length;f=d(f);var g,h,i,j=[e[0]],k=[];for(h=a(e);f.length;)g=f.shift(),i=b.separate(h,g),j.push(i.point),k.push(c(i.left)),h=i.right;return j.push(e[e.length-1]),k.push(c(h)),{points:j,beziers:k}},separate:function(a,b){for(var c,d,e=1-b,f=function(a){return[a[0][0]*e+a[1][0]*b,a[0][1]*e+a[1][1]*b]},g=function(a,b){return[f([a[0],b[0]]),f([a[1],b[1]])]},h=function(a){var b,c=[];for(b=0;b<a.length-1;b++)c.push(g(a[b],a[b+1]));return c},i=[],j=[],k=a;k.length;)d=k[0],i.push([d[0],f(d)]),d=k[k.length-1],j.unshift([f(d),d[1]]),1==k.length&&(c=f(k[0])),k=h(k);return{point:c,left:i,right:j}},through:function(a,b){if(void 0===b&&(b=a.length-1),2>b)return null;var c=[];if(2===b){var d=a[0],e=a[2],f=a[1],g=[(d[0]+e[0])/2,(d[1]+e[1])/2],h=[2*f[0]-g[0],2*f[1]-g[1]];c.push(d,h,e)}return c},byLength:function(c,d){d=d||1;var e={length:0,map:[],accumulate:function(){var b,f,g,h,i=e.separate(a(c),1),j=e.map;for(h=f=g=0;;){if(h=Math.round(f/d),j[h]||(j[h]=g),b=i.shift(),!b){j[h]=1;break}f+=b.length,g+=b.rate}e.length=f},separate:function(a,c){var d,f=a[0][0],g=a[a.length-1][1],h=e.distance(f,g);return e.approximate(a)?[{length:h,rate:c}]:(d=b.separate(a,.5),f=e.separate(d.left,c/2),g=e.separate(d.right,c/2),f.concat(g))},approximate:function(a){var b,c,e=a[0][0];for(b=0;b<a.length;b++)if(c=a[b][1],Math.abs(c[1]-e[1])+Math.abs(c[0]-e[0])>d)return!1;return!0},distance:function(a,b){var c=b[0]-a[0],d=b[1]-a[0];return Math.sqrt(c*c+d*d)}};e.accumulate();var f={length:e.length,mapped:function(a){return e.map[Math.round(e.length*a/d)]},slice:function(a,d){return b.slice(c,f.mapped(a),f.mapped(d))},breakdown:function(){var a=Array.prototype.slice.call(arguments).map(f.mapped);return a.unshift(c),b.breakdown.apply(this,a)}};return f}}}()}))}(nx),function(a){var b=a.define("nx.geometry.Vector",{statics:{approximate:function(b,c,d){if(!b||!c||b.length!=c.length)return!1;var e;for(e=0;e<b.length;e++)if(!a.geometry.Math.approximate(b[e],c[e],d))return!1;return!0},equal:function(a,b){if(!a||!b||a.length!=b.length)return!1;var c;for(c=0;c<a.length;c++)if(a[c]!==b[c])return!1;return!0},plus:function(a,b){return[a[0]+b[0],a[1]+b[1]]},transform:function(b,c){var d=[[b.concat([1])]].concat(Array.prototype.slice.call(arguments,1));return a.geometry.Matrix.multiply.apply(a.geometry.Matrix,d)[0].slice(0,2)},multiply:function(a,c){return b.transform(a,[[c,0,0],[0,c,0],[0,0,1]])},abs:function(a,c){if(1==arguments.length)return Math.sqrt(a[0]*a[0]+a[1]*a[1]);var d=c/b.abs(a);return b.transform(a,[[d,0,0],[0,d,0],[0,0,1]])},reverse:function(a){return b.transform(a,[[-1,0,0],[0,-1,0],[0,0,1]])},rotate:function(c,d){var e=a.geometry.Math.sin(d),f=a.geometry.Math.cos(d);return b.transform(c,[[f,e,0],[-e,f,0],[0,0,1]])}}})}(nx),function(a){a.define("nx.geometry.MatrixSupport",{properties:{matrix:{value:function(){return a.geometry.Matrix.I}},transform_internal_:{dependencies:"matrix",value:function(b){if(!b)return this._transform_internal_||{x:0,y:0,scale:1,rotate:0};var c=NaN,d=NaN;return a.geometry.Matrix.isometric(b)&&(c=Math.sqrt(b[0][0]*b[0][0]+b[0][1]*b[0][1]),d=Math.atan2(b[1][0],b[0][0])),{x:b[2][0],y:b[2][1],scale:c,rotate:d}}},x:{value:0,set:function(a){return this._applyTransform("x",a),!1}},y:{value:0,set:function(a){return this._applyTransform("y",a),!1}},scale:{value:1,set:function(a){return this._applyTransform("scale",a),!1}},rotate:{value:0,set:function(a){return this._applyTransform("rotate",a),!1}}},methods:{init:function(){this.inherited(),this.retain(a.Object.affectBinding(this,"x",a.binding("transform_internal_.x",!0,function(a,b){isNaN(this._transform_internal_.x)||this._x===this._transform_internal_.x||(this._x=this._transform_internal_.x,this.notify(b))}.bind(this)))),this.retain(a.Object.affectBinding(this,"y",a.binding("transform_internal_.y",!0,function(a,b){isNaN(this._transform_internal_.y)||this._y===this._transform_internal_.y||(this._y=this._transform_internal_.y,this.notify("y"))}.bind(this)))),this.retain(a.Object.affectBinding(this,"scale",a.binding("transform_internal_.scale",!0,function(a,b){isNaN(this._transform_internal_.scale)||this._scale===this._transform_internal_.scale||(this._scale=this._transform_internal_.scale,this.notify(b))}.bind(this)))),this.retain(a.Object.affectBinding(this,"rotate",a.binding("transform_internal_.rotate",!0,function(a,b){isNaN(this._transform_internal_.rotate)||this._rotate===this._transform_internal_.rotate||(this._rotate=this._transform_internal_.rotate,this.notify(b))}.bind(this))))},getMatrixInversion:function(){var b=this.matrix();return b?a.geometry.Matrix.inverse(b):null},applyTranslate:function(b,c){this.matrix(a.geometry.Matrix.multiply(this.matrix(),[[1,0,0],[0,1,0],[b,c,1]]))},applyScale:function(b,c){c?this.matrix(a.geometry.Matrix.multiply(this.matrix(),[[1,0,0],[0,1,0],[-c[0],-c[1],1]],[[b,0,0],[0,b,0],[0,0,1]],[[1,0,0],[0,1,0],[c[0],c[1],1]])):this.matrix(a.geometry.Matrix.multiply(this.matrix(),[[b,0,0],[0,b,0],[0,0,1]]))},applyRotate:function(b,c){var d=(this.x(),this.y(),Math.sin(b)),e=Math.cos(b);c?this.matrix(a.geometry.Matrix.multiply(this.matrix(),[[1,0,0],[0,1,0],[-c[0],-c[1],1]],[[e,d,0],[-d,e,0],[0,0,1]],[[1,0,0],[0,1,0],[c[0],c[1],1]])):this.matrix(a.geometry.Matrix.multiply(this.matrix(),[[e,d,0],[-d,e,0],[0,0,1]]))},applyMatrix:function(){var b=Array.prototype.slice.call(arguments);b=a.array.query({array:b,mapping:function(b){return a.is(b,a.geometry.Matrix)?b.matrix():b}}),b.unshift(this.matrix()),this.matrix(a.geometry.Matrix.multiply.apply(this,b))},_applyTransform:function(a,b){if(this["_"+a]!==b&&!isNaN(b))if(b===this._transform_internal_[a])this["_"+a]=b,this.notify(a);else switch(a){case"x":this.applyTranslate(b-this._transform_internal_.x,0);break;case"y":this.applyTranslate(0,b-this._transform_internal_.y);break;case"scale":this.applyScale(b/this._transform_internal_.scale,[this._transform_internal_.x,this._transform_internal_.y]);break;case"rotate":this.applyRotate(b-this._transform_internal_.rotate,[this._transform_internal_.x,this._transform_internal_.y])}}}})}(nx),function(a){var b=a.define("nx.geometry.Matrix",{mixins:[a.geometry.MatrixSupport],methods:{init:function(c){this.inherited(),this.matrix(c?a.clone(c):b.I)},equal:function(c){return b.equal(this.matrix(),a.is(c,b)?c.matrix():c)}},statics:{I:[[1,0,0],[0,1,0],[0,0,1]],isometric:function(a){return a&&(a[0][0]||a[0][1])&&a[0][0]===a[1][1]&&a[0][1]===-a[1][0]},approximate:function(b,c,d){if(!b||!c||b.length!=c.length)return!1;var e;for(e=0;e<b.length;e++)if(!a.geometry.Vector.approximate(b[e],c[e],d))return!1;return!0},equal:function(b,c){if(!b||!c||b.length!=c.length)return!1;var d;for(d=0;d<b.length;d++)if(!a.geometry.Vector.equal(b[d],c[d]))return!1;return!0},multiply:function(){for(var a,b,c,d,e,f,g,h,i,j,k,l=Array.prototype.slice.call(arguments);l.length>1;){if(a=l[0],b=l[1],a[0].length!=b.length)return null;for(i=a.length,j=b[0].length,k=b.length,c=[],f=0;i>f;f++){for(d=[],g=0;j>g;g++){for(e=0,h=0;k>h;h++)e+=a[f][h]*b[h][g];d.push(e)}c.push(d)}l.splice(0,2,c)}return l[0]},transpose:function(a){var b,c,d=[],e=a.length,f=a[0].length;for(c=0;f>c;c++)for(d[c]=[],b=0;e>b;b++)d[c].push(a[b][c]);return d},inverse:function(a){var b=a[0][0],c=a[0][1],d=a[1][0],e=a[1][1],f=a[2][0],g=a[2][1],h=b*e-c*d;return 0==h?null:[[e/h,-c/h,0],[-d/h,b/h,0],[(d*g-e*f)/h,(c*f-b*g)/h,1]]}}})}(nx);